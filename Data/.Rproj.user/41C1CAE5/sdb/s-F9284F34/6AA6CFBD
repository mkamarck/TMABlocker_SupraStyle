{
    "contents" : "#Import Libraries\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(plotrix)\nlibrary(ggplot2)\nlibrary(reshape2)\nlibrary(plyr)\nlibrary(drc)\nlibrary(tidyverse)\nlibrary(kimisc)\nlibrary(data.table)\nlibrary(combinat)\nlibrary(gtools)\nlibrary(wesanderson)\nlibrary(platetools)\nlibrary(ggplot2)\nlibrary(viridis)\n\n\n\n#Import Data####\nsubj <- dir(path = \"Raw Data/TMA_DR_jars\", pattern=\"\\\\.txt$\", full.names=TRUE) # creating a list of all file names\nnames(subj)  <- basename(subj)\ndf <- ldply(subj, read.delim, stringsAsFactors=FALSE) \n\n#subset the data\ndf.jars <- subset(df, select = c(\"Subject\", \"Trial\", \"TrainList\", \"Running.Block.\", \"IntensityRating\",\"Jar\",\"Concentration\")) \ndf.jars$IntensityRating.inv <- 580-as.integer(df.jars$IntensityRating)\n\n#Trial Data\ndf.trialJars <- subset(df.jars, Running.Block. == \"Test\", select = c(\"Subject\", \"Trial\",  \"Running.Block.\", \"IntensityRating.inv\",\"Jar\",\"Concentration\"))\n\n#Normalize####\nscale01 <- function(value, minValue, maxValue) {\n  (value - minValue)/(maxValue - minValue)\n}\n#returns dataframe with the minimum and maximum values for each subject\nsubjMinMax <- ddply(df.trialJars, .variables = c(\"Subject\"), .fun = summarize, minValue = min(IntensityRating.inv), maxValue = max(IntensityRating.inv))\n#merges the max and min values with the full dataframe\ndf.scaleJars <- merge(df.trialJars, subjMinMax)\n#calculates the normalized values using the scale function as written\ndf.scaleJars$normValue <- scale01(df.scaleJars$IntensityRating.inv, df.scaleJars$minValue, df.scaleJars$maxValue)\n\n#Plot all Subjects####\n#normalized\nggplot(data = df.scaleJars, aes(x = Concentration, y = normValue, color = factor(Subject))) +\n  geom_point() +\n  facet_wrap(~Subject)\n\n#plot all subjects raw data\nggplot(data = df.trialJars, aes(x = Concentration, y = IntensityRating.inv, color = factor(Subject))) +\n  geom_point() +\n  facet_wrap(~Subject)\n\n\n#run HIll model#####\nTMAjars.model <- drm(formula = IntensityRating.inv~Concentration, data = subset(df.scaleJars, Subject !=6), fct = LL.4(fixed = c(1, NA, NA, NA), names = (c(\"Slope\", \"Top\", \"Bottom\", \"ED\"))))\nsummary(TMAjars.model)    \nTMAjars.graph = function(x){\n  summary(TMAjars.model)$coefficients[2,1] + (summary(TMAjars.model)$coefficients[1,1]-summary(TMAjars.model)$coefficients[2,1])/(1+10^((log10(summary(TMAjars.model)$coefficients[3,1]) - x)*1))\n}\n\ndf.scaleJars$logConcentration <- log10(df.scaleJars$Concentration)\ndf.scaleJars$logConcentration[which(df.scaleJars$logConcentration == -Inf)]=-3\n#drm is dose response model function , summary give sum. stats , \n#LL.4 sets the 4 parameters of sigmoid curve ( slope at 1, looking for other)\n\nggplot(data = subset(df.scaleJars, Subject !=6), aes(x = logConcentration, y = IntensityRating.inv, color = factor(Subject))) +\n  geom_point() +\n  stat_function(fun = TMAjars.graph)\n  ### Finally, this last bit doesn't run. Get this: Error in layer(data = data, mapping = mapping, stat = StatFunction, \n     #geom = geom,  : object 'model.TMAjars' not found\n\n  ####do this normalized#####\n  #run HIll model#####\n  TMAjars.model <- drm(formula = normValue~Concentration, data = subset(df.scaleJars, Subject !=6), fct = LL.4(fixed = c(1, NA, NA, NA), names = (c(\"Slope\", \"Top\", \"Bottom\", \"ED\"))))\n  summary(TMAjars.model)    \n  TMAjars.graph = function(x){\n    summary(TMAjars.model)$coefficients[2,1] + (summary(TMAjars.model)$coefficients[1,1]-summary(TMAjars.model)$coefficients[2,1])/(1+10^((log10(summary(TMAjars.model)$coefficients[3,1]) - x)*1))\n  }\n  \n  df.scaleJars$logConcentration <- log10(df.scaleJars$Concentration)\n  df.scaleJars$logConcentration[which(df.scaleJars$logConcentration == -Inf)]=-3\n  #drm is dose response model function , summary give sum. stats , \n  #LL.4 sets the 4 parameters of sigmoid curve ( slope at 1, looking for other)\n  \n  ggplot(data = subset(df.scaleJars, Subject !=6), aes(x = logConcentration, y = normValue, color = factor(Subject))) +\n    geom_point() #+\n  stat_function(fun = TMAjars.graph)\n\n",
    "created" : 1500585117926.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "33|10|42|113|\n",
    "hash" : "3016793500",
    "id" : "6AA6CFBD",
    "lastKnownWriteTime" : 1500653514,
    "path" : "~/Downloads/TMA_Jars.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "type" : "r_source"
}