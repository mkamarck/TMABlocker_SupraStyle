{
    "contents" : "---\ntitle: \"test-retest_TMA Blocker Summer 2016\"\noutput: html_document\n---\n\nConducting a test-retest correlation analysis to see if the participant are able to perform the task.  W are setting .5 as an arbitrary cut-off point (meaning the answers to the same trial are 50% correlated). \nThis graph shows the ratings for each trial type the first time the participant rated versus the second rating. \n\n```{r, echo=FALSE}\n#test - retest\n#see how consistent participants were with their rating of stimuli\n#Import Libraries\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(plyr)\n\n#read all files from directory\nsubj <- dir(path = \"/Volumes/mainland/Projects/TMA blocker/Split Nostril Study/Setup2-Olfactometer/Code/SplitNostrilSetup_07_2016/DataPilot2/\", pattern=\"\\\\.txt$\", full.names=TRUE)# creating a list of all file names\nnames(subj)  <- basename(subj)\ndf  <- ldply(subj, read.delim, stringsAsFactors=FALSE)\n#check number of participants\nnumParticipants <- length(unique(df$Subject))\n#subset to get the test data\ntestData <- subset(df, TestMode == \"No\" & Procedure.SubTrial. == \"ExperimentProc\" & Subject !=1 & Subject != 2 & Subject !=57, select = c (\"Subject\", \"Running.Block.\", \"Trial\", \"IntensityRatingAntag\", \"IntensityRatingFishy\", \"RightType\", \"LeftType\"))\n#convert scales (these scales are on a different scale than the previous scales)\n#580 is zero on the scale and 80 is the highest\ntestData$FishyRating  <- 580 - as.integer(testData$IntensityRatingFishy)\ntestData$AntagRating  <- 580 - as.integer(testData$IntensityRatingAntag)\n#make sure the conversion worked - there should be no items coming up in this test\ncheckConversion <- testData[which(testData$FishyRating < 0 | testData$AntagRating <0),]\n#tidy up data\ntestData.sub <- subset(testData, select = c(\"Subject\", \"Running.Block.\", \"Trial\",\"RightType\", \"LeftType\", \"FishyRating\", \"AntagRating\"))\ntestData.melt <- melt(testData.sub, c(\"Subject\", \"Running.Block.\", \"Trial\",\"RightType\", \"LeftType\"), factorsAsStrings = FALSE)\ntestData.melt$value <- as.double(testData.melt$value)\ntestData.melt <- rename(testData.melt, c(\"variable\" = \"IntensityRating\")) #rename variable\n#name the variables the other way\nnostriltyperelabel <- read.csv(\"/Volumes/mainland/Projects/TMA\\ blocker/Split\\ Nostril\\ Study/Setup2-Olfactometer/Raw\\ Data\\ 3-2016/NostrilTypeRelabel.csv\") \ntestDataRename <- merge (testData.melt, nostriltyperelabel)\n\n#to get test-retest we are going to have to split the database into trials 1-9 and 10-18 for the first and second rating of the same stimulus. \ntestDataRename$Trial <- as.numeric(testDataRename$Trial)\ntestDataRename1 <- subset(testDataRename, Trial < 10)\ntestDataRename2 <- subset(testDataRename, Trial >  9)\ntestDataRename1 <- testDataRename1[,-5]\ntestDataRename2 <- testDataRename2[,-5]\nnames(testDataRename1) <- c(\"RightType\", \"LeftType\", \"Subject\", \"Test\", \"IntensityRating\", \"trial1\", \"OdorType\", \"RightNostril\", \"LeftNostril\")\nnames(testDataRename2) <- c(\"RightType\", \"LeftType\", \"Subject\", \"Test\", \"IntensityRating\", \"trial2\", \"OdorType\", \"RightNostril\", \"LeftNostril\")\ntestData.trials <- merge(testDataRename1, testDataRename2)\n\nggplot(testData.trials, aes(x = trial1, y = trial2, colour = factor(Subject))) +\n  geom_point() +\n  facet_grid(IntensityRating ~Test)\n```\n\nHere is the correlation for each subject across a set of trials in the first block of trials (with antagonist green) or second block of trials (with control inalool). Very few subjects are competent at this task. \n```{r, echo = FALSE}\n#find the correlation by person and test and which scale they are rating on.\n#pdf(\"/Volumes/mainland/Projects/TMA blocker/Split Nostril Study/Setup2-Olfactometer/Code/SplitNostrilSetup_07_2016/testretest.pdf\")\ntestData.corr <- ddply(testData.trials, .variables = c(\"Subject\", \"IntensityRating\", \"Test\"), function(x) trial.cor = cor(x$trial1, x$trial2))\ntestData.corr$trial.corr <- abs(testData.corr$V1)\nggplot(testData.corr, aes(x = Test, y = trial.corr, colour = IntensityRating))+ \n  geom_point() + \n  facet_wrap(~Subject) +\n  geom_hline(yintercept= .5) +\n  ylab(\"Pearson's Correlation\") +\n  ggtitle(\"Test-Retest Correlation per subject\")\n#dev.off()\n```\n\n",
    "created" : 1497385358821.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1264386815",
    "id" : "16B486FC",
    "lastKnownWriteTime" : 1497384749,
    "path" : "/Volumes/mainland/Projects/TMA blocker/Split Nostril Study/Setup2-Olfactometer/Code/SplitNostrilSetup_07_2016/test-retest TMA Blocker Summer 2016.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_markdown"
}