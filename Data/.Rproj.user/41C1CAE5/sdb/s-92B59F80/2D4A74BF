{
    "contents" : "#Import Libraries\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(pipeR)\n\n#Import Data\nsubj <- dir(path = \"Raw Data/\", pattern=\"\\\\.txt$\", full.names=TRUE)# creating a list of all file names\nnames(subj)  <- basename(subj)\ndf  <- ldply(subj, read.delim, stringsAsFactors=FALSE) \n#subset variables\ndf <- subset(df, select = c(\"Subject\", \"Trial\", \"valve\", \"valve2\", \"TrainList\", \"Running.Block.\", \"IntensityRating\"))\ndf$IntensityRating.inv <- 580-as.integer(df$IntensityRating)\n\n#Trial Data\ndf.trial <- subset(df, Running.Block. == \"Test\", select = c(\"Subject\", \"Trial\", \"valve\", \"valve2\", \"Running.Block.\", \"IntensityRating.inv\"))\n\n#name the trials based on valves\nvalve.list <- read.csv(\"Analysis/TMA_supra_Pilot_merge.csv\")\n\n#merge with trial list\ndf.trial_merge <- merge(df.trial, valve.list )\n#lost some stuff, try graphing and get back to it. \n\n#graph\nggplot(data = subset(df.trial_merge), aes(x = Concentration, y = IntensityRating.inv, color = Type)) +\n  geom_point() +\n  facet_wrap(~Type)\n\n\n\n#graph each subject\nfor (i in c(3, 8)){\n  plot <- ggplot(data = subset(df.trial_merge, Subject == i & Type == \"TMA\"), aes(x = Concentration, y = IntensityRating.inv, color = Type)) +\n    geom_point() +\n    facet_wrap(~Type) +\n    ggtitle(paste(\"Subject # \", i))\n  print(plot)\n}\n\n#what's going on with TMA?\nggplot(data = subset(df.trial_merge, Subject %in% c(5,7,8) & Type == \"TMA\"), aes(x = Concentration, y = IntensityRating.inv, color = factor(Subject))) +\n    geom_point() +\n    #facet_wrap(~Type) +\n    ggtitle(\"TMA Response\")\n\n#graph each subject better\n#pdf(\"pilot graphs.pdf\")\n# for (i in c(1, 3, 5, 6,7,8)){\n#  plot <-  ggplot(data = subset(df.trial_merge, Subject == i), aes(x = Concentration, y = IntensityRating.inv, color = Type)) +\n#     geom_point() +\n#     ggtitle(paste(\"Subject # \", i))\n#   print(plot)\n# }\n#dev.off()\n\n\n\n########normalize data and graph it again ##########\n#scale function\nscale01 <- function(value, minValue, maxValue) {\n  (value - minValue)/(maxValue - minValue)\n}\n\nsubjMinMax <- ddply(df.trial_merge, .variables = c(\"Subject\"), .fun = summarize, minValue = min(IntensityRating.inv), maxValue = max(IntensityRating.inv))\ndf.scale <- merge(df.trial_merge, subjMinMax)\ndf.scale$normValue <- scale01(df.scale$IntensityRating.inv, df.scale$minValue, df.scale$maxValue)\n\n#graph normalized\nggplot(data = subset(df.scale), aes(x = Concentration, y = normValue, color = Type)) +\n  geom_point() +\n  facet_wrap(~Type)\n\n#from this it looks like something is still going on with TMA, so we need to look at some other things. \n\n#Look at order of presentation per subject. \nsubjectTMA <- subset(df.trial_merge, odor1 == \"TMA\" & Subject == 6)\n\n#########DR######\n#import\nsubj <- dir(path = \"Raw Data/DR\", pattern=\"\\\\.txt$\", full.names=TRUE)# creating a list of all file names\nnames(subj)  <- basename(subj)\nDR  <- ldply(subj, read.delim, stringsAsFactors=FALSE) \n#subset variables\nDR <- subset(DR, select = c(\"Subject\", \"Trial\", \"valve\", \"valve2\", \"TrainList\", \"Running.Block.\", \"IntensityRating\"))\nDR$IntensityRating.inv <- 580-as.integer(DR$IntensityRating)\n#Trial Data\nDR.trial <- subset(DR, Running.Block. == \"Test\", select = c(\"Subject\", \"Trial\", \"valve\", \"valve2\", \"Running.Block.\", \"IntensityRating.inv\"))\n\n#name the trials based on valves\nvalve.list <- read.csv(\"Analysis/TMA_DR_merge.csv\")\n#merge with trial list\nDR.trial_merge <- merge(DR.trial, valve.list)\n\n\n#plot\nggplot(data = subset(DR.trial_merge), aes(x = TMA.Concentration, y = IntensityRating.inv, color = factor(valve2))) +\n  geom_point() +\n  facet_wrap(~Subject) +\n  scale_x_log10()\n\n#code DEP and water as factors (-1 and -2, and exclude them from my model, but label them on the graph later)\n\n#TODO:\n#1. compare TMA from first to second run\n#2. model these functions with equations\n#3. fix the controls to graph well\n#can we normalize and model this? are we actually getting a dose-response curve? \n\n\n\n############1. compare TMA from first to second run##############\n#pull TMA only from the first set for the subjects who have run in both experiments\ndf.TMA <- subset(df.trial_merge, Type == \"TMA\" & Subject %in% c(unique(DR$Subject)))\n#give TMA true concentrations from the first dataset\ndf.TMA$TMA.Concentration = 0\nfor(i in 1:length(df.TMA$valve)){\n  if(df.TMA$Concentration[i] == 1){\n    df.TMA$TMA.Concentration[i] = 0.1\n  }\n  if(df.TMA$Concentration[i] == 2){\n    df.TMA$TMA.Concentration[i] = 0.3\n  }\n  if (df.TMA$Concentration[i] == 3){\n    df.TMA$TMA.Concentration[i] = 0.6\n  }\n  if (df.TMA$Concentration[i] == 4){\n    df.TMA$TMA.Concentration[i] = 1\n  }\n  if (df.TMA$Concentration[i] == 5){\n    df.TMA$TMA.Concentration[i] = 3\n  }\n  if (df.TMA$Concentration[i] == 6){\n    df.TMA$TMA.Concentration[i] = 6\n  }\n}\n#give each an identifier\ndf.TMA$experiment = \"Blocker\"\nDR.trial_merge$experiment = \"TMA DR\"\n#subset df.TMA to match\ndf.TMA <- subset(df.TMA, select = c(\"valve\", \"Subject\", \"Trial\", \"valve2\", \"Running.Block.\", \"IntensityRating.inv\", \"TMA.Concentration\", \"experiment\"))\n#combine the two datasets\nTMA.all <- rbind(df.TMA, DR.trial_merge)\n#get rid of the blanks for now\nTMA.all$TMA.Concentration = as.numeric(TMA.all$TMA.Concentration)\n\n#graph\nggplot(data = TMA.all, aes(x = TMA.Concentration, y = IntensityRating.inv, color = factor(experiment))) +\n  geom_point() +\n  facet_grid(Subject~.)\n#same graph with different wrapping\nggplot(data = TMA.all, aes(x = TMA.Concentration, y = IntensityRating.inv, color = factor(experiment))) +\n  geom_point() +\n  facet_wrap(~Subject)\n\n#graph just the matching concentrations of TMA\nggplot(data = subset(TMA.all, TMA.Concentration %in% c(.1,.3,.6,1,3,6)), aes(x = TMA.Concentration, y = IntensityRating.inv, color = factor(experiment))) +\n  geom_point() +\n  #facet_wrap(~Subject)\n  facet_grid(Subject~.) +\n  scale_x_log10()\n\n#Look for effect of previous trial on the current trial. \n",
    "created" : 1496350378459.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3989099332",
    "id" : "2D4A74BF",
    "lastKnownWriteTime" : 1496949512,
    "path" : "/Volumes/mainland/Projects/TMA blocker/SupraStyle/Data/Analysis/PilotData.R",
    "project_path" : "Analysis/PilotData.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}